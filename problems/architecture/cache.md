# 缓存

缓存的典型场景有以下几种。

- 对于需要复杂运算后才能得到的数据，且数据的实时性要求不高，那么就可以把计算结果事先存储在缓存中，当客户端请求该数据时只需要从缓存中读取。比如在一个定时任务中进行周期性的计算，完成计算后把结果写入缓存中。

- 对于读多写少的系统，可以把数据放到缓存中，减小数据库的压力。

## 缓存穿透

缓存穿透是指缓存没有起到作用，比如以下几种场景。

- 访问的数据不存在，请求会穿过缓存访问数据库，黑客利用这一点大量访问不存在的数据从而拖垮数据库。解决方法是把不存在的数据在缓存中存储一个空值，也可以按照业务规则对参数的合法性进行检查，从而挡掉一部分的恶意攻击。

- 爬虫对数据进行完整的抓取而系统只缓存了一部分数据，比如对于一个分页查询，缓存只保留了前10页的数据（热点数据），而爬虫从第1页爬到最后一页，系统就需要为大部分不常被访问的数据生成大量的缓存，浪费系统资源。这种情况下没有很好的解决方法，如果我们识别并禁止了爬虫有可能会影响SEO。

## 缓存雪崩

缓存雪崩是指当缓存失效或被清除时，在缓存被重新创建之前有大量的请求直接访问数据库，从而导致数据库压力剧增，拖垮整个系统。有以下几种解决方案。

- 针对不同的数据设置不同的过期时间，避免大量缓存在同一时间失效。
- 当有大量线程尝试重建缓存时，利用分布式锁保证只有一个线程可以成功重建缓存。
- 由额外的后台线程定时更新缓存，并且缓存的过期时间设为永久，业务线程只能从缓存读取数据，不能读取数据库也不能更新缓存。

## 缓存热点

## 缓存预热

在服务启动时可以用后台线程预先把相关的缓存加载到缓存系统中，而不是等到请求来临时才创建缓存。

## 数据一致性

## 参考

1. [《如何优雅的设计和使用缓存？》](https://juejin.im/post/5b849878e51d4538c77a974a)
