# 秒杀

## 热点商品

秒杀的商品属于热点商品。热点商品又可以分为静态热点商品和动态热点商品，前者是指能够提前预测的商品，后者是指不能提前预测的商品。针对这两种情况我们可以有不同的对策。

### 静态热点商品

针对静态热点商品，我们可以在业务上让卖家提前进行标记，或者通过系统自动计算出卖家商铺中排名最靠前（销量、浏览量）的几件商品，对于这些预先标记的商品我们就可以提交进行缓存。

- 动态热点商品

针对动态热点商品，我们需要构建一个可以自动发现热点商品的系统，大致思路是在上游中间件中（如Nginx）对热点数据进行统计（如Url），然后通知下游服务提前做好应对（如提前进行缓存）。

![](resources/seckill_1.jpg)

## 削峰

假设下游某个服务每秒只能处理1000个请求，秒杀开始的瞬间上游服务向该下游服务发起了10万个请求，那么一定有大量的连接被阻塞，因为下游服务处理不过来，而此时秒杀活动还在进行，请求不断积压，导致上游服务资源也被耗尽，引起雪崩。

解决方法就是对流量进行削峰，使服务端处理变得更加平稳。最普遍的方法是利用消息队列，上有服务把请求放入消息队列，下游从消息队列中取出请求进行处理，在这里消息队列起到了缓冲的作用。

![](resources/seckill_2.jpg)

除了技术上的手段，在业务上也可以利用验证码、答题等方法把请求的时间分散，比如本来10万个请求在1秒内发出，现在变成5秒内发出。
