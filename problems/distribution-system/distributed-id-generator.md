# 分布式ID生成器

## Snowflake

Snowflake是twitter提出的分布式ID生成方案，它是一个64位长度的序列，其结构如下。

![](resources/distributed_id_generator_1.jpg)

其中左起第一位永远是0，可以看作是符号位，表明序列不为负数；41位的时间戳记录的是毫秒时间，一般是当前时间减去某个固定起始时间的偏移量而不是从1970年1月1日算起，一共可以使用69年；10位机器ID可以分配给1024台机器；最后的12位序列号可以在同一毫秒内生成4096个不同的序列，如果某一毫秒下的4096个序列已经用完了，那么需要等待至下一豪秒以防止ID重复。

Snowflake的缺点是严重依赖机器时间，如果机器时间出现了回拨，就有可能生成重复的ID，解决方法是在服务启动时进行核对，如果时间回拨则启动失败，另外在运行过程中发现回拨则可以进行等待并通过监控系统上报异常。

## 参考

1. 《Leaf——美团点评分布式ID生成系统》(https://tech.meituan.com/2017/04/21/mt-leaf.html)
